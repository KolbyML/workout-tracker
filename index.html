<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d1117">
    <meta name="description" content="Calisthenics Progression Tracker">
    <title>Calisthenics Master</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        /* ... (KEEPING THE EXACT SAME STYLES AS v8) ... */
        :root { --primary: #3b82f6; --success: #238636; --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --text-muted: #8b949e; --border: #30363d; --box-empty: #2d333b; --line-color: #30363d; --accent-blue: #58a6ff; --accent-gold: #d29922; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px 20px 60px 20px; user-select: none; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 800px; width: 100%; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 1.8rem; color: #f0f6fc; }
        h2.section-title { text-align: center; margin: 40px 0 20px 0; color: var(--text); border-bottom: 1px solid var(--border); line-height: 0.1em; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px; }
        h2.section-title span { background: var(--bg); padding: 0 15px; }
        p.subtitle { color: var(--text-muted); margin-top: 5px; font-size: 0.9rem; }
        .status-card { background-color: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 25px; margin-bottom: 20px; }
        .day-indicator { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; display: block; margin-bottom: 5px; }
        .workout-title { font-size: 2rem; font-weight: 800; margin: 0 0 20px 0; color: #f0f6fc; }
        .exercise-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px; padding: 12px 15px; display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; text-align: left; }
        .exercise-header { display: flex; justify-content: space-between; color: var(--text-muted); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }
        .exercise-main { display: flex; justify-content: space-between; align-items: center; }
        .exercise-name { font-size: 1.05rem; font-weight: 600; color: var(--text); }
        .controls { display: flex; gap: 5px; }
        .btn-icon { background: var(--box-empty); border: 1px solid var(--border); color: var(--text); width: 30px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .btn-icon:hover { background: var(--border); }
        .btn-complete { background-color: var(--success); color: white; border: 1px solid rgba(240, 246, 252, 0.1); padding: 18px 32px; font-size: 1.1rem; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-complete:disabled { opacity: 0.5; cursor: not-allowed; background-color: var(--card); }
        .undo-link { display: block; margin-top: 15px; color: var(--text-muted); font-size: 0.8rem; text-decoration: underline; cursor: pointer; text-align: center; }
        .calendar-section { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; overflow-x: auto; margin-bottom: 40px; }
        .calendar-nav { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; font-weight: bold; }
        .months-grid { display: flex; gap: 15px; min-width: 600px; justify-content: center; }
        .month-chunk { width: 80px; }
        .month-label { font-size: 0.7rem; color: var(--text-muted); text-align: center; margin-bottom: 4px; }
        .days-container { display: flex; flex-wrap: wrap; gap: 2px; }
        .day-box { width: 10px; height: 10px; background-color: var(--box-empty); border-radius: 2px; }
        .day-box.active { background-color: var(--success); }
        .trees-wrapper { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        .skill-tower { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; }
        .tower-header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .tower-icon { font-size: 2.5rem; display: block; margin-bottom: 5px; }
        .tower-title { font-size: 1.2rem; font-weight: 800; color: #f0f6fc; }
        .tower-desc { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .node-map { position: relative; display: flex; flex-direction: column-reverse; padding: 20px 0; }
        .node-map::before { content: ''; position: absolute; top: 20px; bottom: 20px; left: 50%; width: 4px; background: var(--line-color); transform: translateX(-50%); border-radius: 2px; z-index: 0; }
        .node-branch { display: flex; justify-content: center; align-items: center; position: relative; margin-bottom: 30px; width: 100%; }
        .node-branch:nth-child(odd) { justify-content: flex-start; padding-left: 10px; }
        .node-branch:nth-child(even) { justify-content: flex-end; padding-right: 10px; }
        .node-branch::before { content: ''; position: absolute; top: 50%; height: 2px; background: var(--line-color); z-index: 0; width: 50%; }
        .node-branch:nth-child(odd)::before { left: 50%; }
        .node-branch:nth-child(even)::before { right: 50%; }
        .node-box { background: var(--box-empty); border: 1px solid var(--border); padding: 10px 12px; border-radius: 8px; width: 45%; text-align: left; font-size: 0.85rem; position: relative; z-index: 2; cursor: pointer; transition: transform 0.2s, background 0.2s; display: flex; justify-content: space-between; align-items: center; opacity: 0.6; filter: grayscale(1); }
        .node-box:hover { transform: scale(1.03); opacity: 1; filter: grayscale(0); }
        .play-icon { font-size: 0.7rem; color: var(--text-muted); opacity: 0.7; }
        .node-branch.unlocked .node-box { opacity: 1; filter: grayscale(0); border-color: var(--success); background: rgba(35, 134, 54, 0.1); }
        .node-branch.unlocked::before { background: var(--success); }
        .node-branch.current .node-box { border-color: var(--accent-blue); background: rgba(56, 139, 253, 0.2); box-shadow: 0 0 12px rgba(56, 139, 253, 0.2); font-weight: bold; }
        .node-branch.current::before { background: var(--accent-blue); }
        .node-branch:last-child .node-box { border-color: var(--accent-gold); text-transform: uppercase; font-weight: 900; letter-spacing: 0.5px; width: 60%; text-align: center; justify-content: center; }
        .node-branch:last-child { justify-content: center; padding: 0; }
        .node-branch:last-child::before { display: none; }
        .hidden { display: none; }
        .day-1-theme .day-indicator { color: var(--accent-blue); }
        .day-2-theme .day-indicator { color: var(--accent-gold); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Calisthenics Master</h1>
            <p class="subtitle" id="streak-subtitle">Loading...</p>
        </header>

        <div id="day1" class="status-card day-1-theme hidden">
            <span class="day-indicator">Day 1</span>
            <div class="workout-title">Push & Pull</div>
            <div id="day1-exercises"></div>
        </div>

        <div id="day2" class="status-card day-2-theme hidden">
            <span class="day-indicator">Day 2</span>
            <div class="workout-title">Legs & Core</div>
            <div id="day2-exercises"></div>
        </div>

        <button id="action-btn" class="btn-complete" onclick="completeWorkout()">Mark Complete</button>
        <a id="undo-btn" class="undo-link hidden" onclick="undoToday()">Ops, go back (Undo)</a>

        <h2 class="section-title"><span>Consistency</span></h2>
        <div class="calendar-section">
            <div class="calendar-nav">
                <button class="btn-icon" onclick="changeYear(-1)">‚Üê</button>
                <span id="year-display">2026</span>
                <button class="btn-icon" onclick="changeYear(1)">‚Üí</button>
            </div>
            <div class="months-grid" id="months-grid"></div>
        </div>

        <h2 class="section-title"><span>Skill Trees</span></h2>
        <div id="tree-wrapper" class="trees-wrapper"></div>
    </div>

    <script>
        // --- PWA SERVICE WORKER REGISTRATION ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.log('SW failed', err));
            });
        }

        // --- APP LOGIC (IDENTICAL TO v8) ---
        const STORAGE_KEY='calisthenics_v8_data';
        const SKILL_DATA={horizontalPush:{goal:"The Planche",desc:"Ultimate Push",icon:"ü¶ç",steps:["Wall Push-ups","Incline Push-ups","Standard Push-ups","Diamond Push-ups","Pseudo Planche Push-ups","Tuck Planche Hold","Adv. Tuck Planche","Straddle Planche","Full Planche"]},verticalPush:{goal:"Handstand Push-up",desc:"Overhead Power",icon:"ü§∏",steps:["Bench Dips","Pike Hold","Pike Push-ups","Elevated Pike PU","Wall Handstand","Wall HSPU","Freestanding Handstand","Freestanding HSPU"]},horizontalPull:{goal:"Front Lever",desc:"Straight Arm Pull",icon:"‚öñÔ∏è",steps:["Door Rows","Incline Rows","Bodyweight Rows","Wide Grip Rows","Tuck Front Lever","Adv. Tuck FL","Single Leg FL","Straddle FL","Full Front Lever"]},verticalPull:{goal:"Muscle Up & OAP",desc:"Explosive Pull",icon:"üöÄ",steps:["Dead Hang","Neg. Chin-ups","Chin-ups","Pull-ups","L-Sit Pull-ups","Explosive Pull-ups","Muscle Up","Archer Pull-ups","One Arm Pull-up"]},squat:{goal:"Pistol Squat",desc:"Leg Mastery",icon:"ü¶µ",steps:["Assisted Squat","Standard Squat","Close Squat","Bulgarian Split Squat","Shrimp Squat","Assisted Pistol","Pistol Squat"]}};
        const CORE_DATA={coreStatic:{goal:"V-Sit",steps:["Plank","L-Sit Tucked","L-Sit","V-Sit"]},coreDynamic:{goal:"Toes to Bar",steps:["Lying Raises","Hanging Knee Raises","Toes to Bar"]}};
        let appState={currentDay:1,history:[],levels:{horizontalPush:2,verticalPush:2,horizontalPull:2,verticalPull:3,squat:1,coreStatic:1,coreDynamic:1,posterior:1}};
        let viewYear=new Date().getFullYear();
        function loadState(){const s=localStorage.getItem(STORAGE_KEY);if(s){const p=JSON.parse(s);appState={...appState,...p,levels:{...appState.levels,...p.levels}};}renderAll();}
        function saveState(){localStorage.setItem(STORAGE_KEY,JSON.stringify(appState));}
        function getLocalISODate(d){const o=d.getTimezoneOffset()*60000;return new Date(d.getTime()-o).toISOString().split('T')[0];}
        function changeLevel(k,d){let l=getListForKey(k);const m=l.length-1;let n=appState.levels[k]+d;if(n<0)n=0;if(n>m)n=m;appState.levels[k]=n;saveState();renderAll();}
        function completeWorkout(){const t=getLocalISODate(new Date());if(appState.history.includes(t))return;appState.history.push(t);appState.currentDay=appState.currentDay===1?2:1;saveState();renderAll();}
        function undoToday(){const t=getLocalISODate(new Date());const i=appState.history.indexOf(t);if(i>-1){appState.history.splice(i,1);appState.currentDay=appState.currentDay===1?2:1;saveState();renderAll();}}
        function changeYear(d){viewYear+=d;renderCalendar();}
        function openTutorial(n){const q=encodeURIComponent(`how to do ${n} calisthenics tutorial`);window.open(`https://www.youtube.com/results?search_query=${q}`,'_blank');}
        function getListForKey(k){if(SKILL_DATA[k])return SKILL_DATA[k].steps;if(CORE_DATA[k])return CORE_DATA[k].steps;return["Glute Bridge","Lunges","Nordic Curls"];}
        function renderAll(){renderWorkout();renderCalendar();renderTrees();}
        function renderWorkout(){const d1=document.getElementById('day1');const d2=document.getElementById('day2');const t=getLocalISODate(new Date());const done=appState.history.includes(t);const btn=document.getElementById('action-btn');const undo=document.getElementById('undo-btn');
        document.getElementById('day1-exercises').innerHTML=generateExerciseHTML('horizontalPush','Horizontal Push')+generateExerciseHTML('verticalPush','Vertical Push')+generateExerciseHTML('verticalPull','Vertical Pull')+generateExerciseHTML('horizontalPull','Horizontal Pull');
        document.getElementById('day2-exercises').innerHTML=generateExerciseHTML('squat','Squat')+generateExerciseHTML('posterior','Posterior Chain')+generateExerciseHTML('coreStatic','Static Core')+generateExerciseHTML('coreDynamic','Dynamic Core');
        if(appState.currentDay===1){d1.classList.remove('hidden');d2.classList.add('hidden');}else{d1.classList.add('hidden');d2.classList.remove('hidden');}
        if(done){btn.textContent="Done for Today ‚úÖ";btn.disabled=true;undo.classList.remove('hidden');}else{btn.textContent="Complete Workout";btn.disabled=false;undo.classList.add('hidden');}
        document.getElementById('streak-subtitle').textContent=`Total Workouts: ${appState.history.length}`;}
        function generateExerciseHTML(k,l){let list=getListForKey(k);const idx=appState.levels[k];const n=list[idx]||list[list.length-1];const isMax=idx===list.length-1;const isMin=idx===0;
        return`<div class="exercise-item"><div class="exercise-header"><span>${l}</span><span>Lvl ${idx+1}/${list.length}</span></div><div class="exercise-main"><div class="exercise-name">${n}</div><div class="controls"><button class="btn-icon btn-learn" onclick="openTutorial('${n}')">‚ñ∂</button><button class="btn-icon" onclick="changeLevel('${k}',-1)" ${isMin?'disabled':''}>‚Üê</button><button class="btn-icon" onclick="changeLevel('${k}',1)" ${isMax?'disabled':''}>‚Üí</button></div></div></div>`;}
        function renderCalendar(){document.getElementById('year-display').textContent=viewYear;const g=document.getElementById('months-grid');g.innerHTML='';const mn=["J","F","M","A","M","J","J","A","S","O","N","D"];
        for(let m=0;m<12;m++){const c=document.createElement('div');c.className='month-chunk';const l=document.createElement('div');l.className='month-label';l.textContent=mn[m];c.appendChild(l);const con=document.createElement('div');con.className='days-container';const dim=new Date(viewYear,m+1,0).getDate();
        for(let d=1;d<=dim;d++){const b=document.createElement('div');const mm=String(m+1).padStart(2,'0');const dd=String(d).padStart(2,'0');const ds=`${viewYear}-${mm}-${dd}`;const act=appState.history.includes(ds);b.className=`day-box ${act?'active':''}`;b.title=ds;con.appendChild(b);}c.appendChild(con);g.appendChild(c);}}
        function renderTrees(){const c=document.getElementById('tree-wrapper');c.innerHTML='';for(const[k,d]of Object.entries(SKILL_DATA)){const cur=appState.levels[k];let h='';d.steps.forEach((s,i)=>{let st='locked';if(i<cur)st='unlocked';if(i===cur)st='current';h+=`<div class="node-branch ${st}"><div class="node-box" onclick="openTutorial('${s}')"><span>${s}</span><span class="play-icon">‚ñ∂</span></div></div>`;});
        c.innerHTML+=`<div class="skill-tower"><div class="tower-header"><div class="tower-icon">${d.icon}</div><div class="tower-title">${d.goal}</div><div class="tower-desc">${d.desc}</div></div><div class="node-map">${h}</div></div>`;}}
        loadState();
    </script>
</body>
</html>